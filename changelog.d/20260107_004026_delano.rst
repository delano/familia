Fixed
-----

- Fix race condition in ``find_by_dbkey`` where keys expiring between EXISTS and HGETALL
  could create objects with nil identifiers, causing ``NoIdentifier`` errors on subsequent
  operations like ``destroy!``. Now always checks for empty hash results regardless of
  ``check_exists`` parameter value.

- Add lazy cleanup of stale ``instances`` sorted set entries when ``find_by_dbkey`` detects
  a non-existent key (via EXISTS check) or an expired key (via empty HGETALL result). This
  prevents phantom instance counts from accumulating when objects expire via TTL without
  explicit ``destroy!`` calls. The cleanup is performed opportunistically during load
  attempts, requiring no background jobs or Redis keyspace notifications.

Added
-----

- Add comprehensive test coverage for ``find_by_dbkey`` race condition and lazy cleanup
  scenarios in ``try/edge_cases/find_by_dbkey_race_condition_try.rb`` (16 new tests).
  Tests cover empty hash handling, lazy cleanup, TTL expiration, count consistency,
  and concurrent access patterns.

AI Assistance
-------------

- Claude helped verify the race condition analysis through multi-agent investigation
  (Explore, Code Explorer, QA Engineer agents) and implemented the fix with lazy cleanup
  and comprehensive test coverage.
